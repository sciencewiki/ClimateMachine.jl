<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Contributing · CLIMA</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="CLIMA logo"/></a><div class="docs-package-name"><span class="docs-autofit">CLIMA</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Common</span><ul><li><a class="tocitem" href="../../Common/MoistThermodynamics/">MoistThermodynamics</a></li></ul></li><li><span class="tocitem">Utilites</span></li><li><span class="tocitem">Atmos</span><ul><li><a class="tocitem" href="../../Atmos/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../Atmos/EDMFEquations/">Eddy-Diffusivity Mass-Flux (EDMF) equations</a></li><li><a class="tocitem" href="../../Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../Atmos/Model/turbulence/">AtmosModel</a></li><li><a class="tocitem" href="../../Atmos/Model/tracers/">AtmosModel</a></li></ul></li><li><a class="tocitem" href="../../Diagnostics/">Diagnostics</a></li><li><a class="tocitem" href="../../ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../LinearSolvers/">LinearSolvers</a></li><li><a class="tocitem" href="../../Mesh/">Mesh</a></li><li><a class="tocitem" href="../../Arrays/">Arrays</a></li><li><a class="tocitem" href="../../DGmethods_old/">DGmethods_old</a></li><li><a class="tocitem" href="../../InputOutput/">InputOutput</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../generated/example_cg/">Conjugate Gradient</a></li><li><a class="tocitem" href="../../generated/literate_markdown/">Notes on Literate</a></li></ul></li><li><span class="tocitem">Developer docs</span><ul><li><input class="collapse-toggle" id="menuitem-13-1" type="checkbox" checked/><label class="tocitem" for="menuitem-13-1"><span class="docs-label">Contribution Guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Contributing</a><ul class="internal"><li><a class="tocitem" href="#Forks-and-branches-1"><span>Forks and branches</span></a></li><li><a class="tocitem" href="#Formatting-and-style-1"><span>Formatting and style</span></a></li><li><a class="tocitem" href="#Bors-and-CI-1"><span>Bors and CI</span></a></li></ul></li><li><a class="tocitem" href="../IterativeSolvers/">Contribution Guide for Abstract Iterative Solvers</a></li></ul></li><li><a class="tocitem" href="../../CodingConventions/">Coding Conventions</a></li><li><a class="tocitem" href="../../AcceptableUnicode/">Acceptable Unicode characters</a></li><li><a class="tocitem" href="../../VariableList/">CliMA Variable List</a></li><li><a class="tocitem" href="../../DiagnosticVariables/">CliMA Diagnostic Variable List</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer docs</a></li><li><a class="is-disabled">Contribution Guides</a></li><li class="is-active"><a href>Contributing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Contributing</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/climate-machine/CLIMA/blob/master/docs/src/ContributionGuides/CONTRIBUTING.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Contributing-1"><a class="docs-heading-anchor" href="#Contributing-1">Contributing</a><a class="docs-heading-anchor-permalink" href="#Contributing-1" title="Permalink"></a></h1><p>CLIMA encourages Pull Requests (PRs) and contributions. The easiest way to contribute is by running code and letting us know what&#39;s wrong by creating issues. In the case that you can specifically pinpoint the issue within the code, please consider submitting a PR with these changes.</p><p>To contribute, we assume that you already have a basic understanding of git and version control as all tools are accessible on Github; however, we will discuss the general workflow for submitting code for review to CLIMA.</p><p>If you are unfamiliar with git and version control, please consider reading the following guides:</p><ul><li><a href="https://www.atlassian.com/git/tutorials">Atlassian (bitbucket) git tutorials. A set of tips and tricks for getting started with git</a></li><li><a href="https://try.github.io/">Github&#39;s git tutorials. A set of resources from github to learn git</a></li></ul><p>There are a bunch of other guides available as well. We will try to guide you along the process here, but this is by no means an exhaustive set of everything you will need to know when using git and version control.</p><h2 id="Forks-and-branches-1"><a class="docs-heading-anchor" href="#Forks-and-branches-1">Forks and branches</a><a class="docs-heading-anchor-permalink" href="#Forks-and-branches-1" title="Permalink"></a></h2><p>To start contributing, first create your own fork (version of CLIMA) <a href="https://github.com/climate-machine/CLIMA">on GitHub</a> and check out your copy:</p><pre><code class="language-none">$ git clone https://github.com/&lt;username&gt;/CLIMA.git
$ cd CLIMA
$ git remote add upstream https://github.com/climate-machine/CLIMA.git</code></pre><p>This will create two places for you to keep code, one called <code>origin</code>, which is your own fork and another called <code>upstream</code>, which is CLIMA&#39;s main repository.</p><p>From there, it is important to create a <em>feature branch</em> for your project:</p><pre><code class="language-none">$ git checkout -b &lt;branchname&gt;</code></pre><p>Creating a feature branch allows you to more easily reconcile your code with the master branch on CLIMA.</p><h3 id="Basic-git-interactions-1"><a class="docs-heading-anchor" href="#Basic-git-interactions-1">Basic git interactions</a><a class="docs-heading-anchor-permalink" href="#Basic-git-interactions-1" title="Permalink"></a></h3><p>Firstly, make sure git knows your name and email address:</p><pre><code class="language-none">$ git config --global user.name &quot;A. Climate Developer&quot;
$ git config --global user.email &quot;j.climate.developer@eg.com&quot;</code></pre><p>From there, we need to begin saving different versions of code. This is done by creating <code>commits</code>, which are save states for all code within the git repository. The basic workflow for creating changes to CLIMA is the following:</p><ol><li><code>git status</code> will show you any changes in your current code from the last commit</li><li><code>git add &lt;FILE&gt;</code> will add any files you want to commit into a staging area</li><li><code>git commit</code> will store any staged files into a commit.</li><li><code>git push origin &lt;branchname&gt;</code> will then push all the changes to <code>origin</code>, which is a nickname for your fork on github.</li><li>When you are happy with all the code on your branch, go to github and click the button to create a pull request with all the changes against CLIMA&#39;s master branch.</li></ol><h3 id="Squash-and-Rebase-1"><a class="docs-heading-anchor" href="#Squash-and-Rebase-1">Squash and Rebase</a><a class="docs-heading-anchor-permalink" href="#Squash-and-Rebase-1" title="Permalink"></a></h3><p>Before merging with CLIMA, use <code>git rebase</code> (not <code>git merge</code>) to sync your work  with the current master.</p><pre><code class="language-none">$ git fetch upstream
$ git rebase upstream/master</code></pre><p>Once the PR is ready for review (or in the process of review), be sure to <a href="https://github.com/edx/edx-platform/wiki/How-to-Rebase-a-Pull-Request#squash-your-changes">squash your commits</a>. This will help us keep the commit history clean on the master branch of CLIMA.</p><h2 id="Formatting-and-style-1"><a class="docs-heading-anchor" href="#Formatting-and-style-1">Formatting and style</a><a class="docs-heading-anchor-permalink" href="#Formatting-and-style-1" title="Permalink"></a></h2><p>For the most part, we follow the <a href="https://github.com/jrevels/YASGuide">YASGuide</a> for Julia formatting, with small exceptions covered in the <a href="https://climate-machine.github.io/CLIMA/latest/CodingConventions.html">Coding Conventions</a> section of the documentation.</p><p>In addition to this, once you are happy with your PR, please apply <a href="https://github.com/domluna/JuliaFormatter.jl">JuliaFormatter.jl</a> to all changed files in the repository.</p><p>To apply our formatter settings to all changed files, run:</p><pre><code class="language-none">julia .dev/format.jl</code></pre><p>Formatting changes should be done as a separate commit, ideally the last commit of the pull request (you may want to leave it until all other changes have been approved).</p><h3 id="Formatting-utility-1"><a class="docs-heading-anchor" href="#Formatting-utility-1">Formatting utility</a><a class="docs-heading-anchor-permalink" href="#Formatting-utility-1" title="Permalink"></a></h3><p>A convenience utility is located at <code>.dev/climaformat.jl</code> that will format the julia files in the given path. For example, from the top-level CLIMA directory</p><pre><code class="language-none">julia .dev/climaformat.jl src/CLIMA.jl</code></pre><p>will format <code>src/CLIMA.jl</code> and</p><pre><code class="language-none">julia .dev/climaformat.jl .</code></pre><p>will format all of CLIMA&#39;s julia files.</p><h3 id="Formatting-githook-1"><a class="docs-heading-anchor" href="#Formatting-githook-1">Formatting githook</a><a class="docs-heading-anchor-permalink" href="#Formatting-githook-1" title="Permalink"></a></h3><p>A <code>pre-commit</code> script that can be placed in <code>$GIT_DIR/hooks/*</code> which will prevent commits of incorrectly formatted julia code.  It will also provide commands that can be run to format the code correctly.</p><p>One may tell git about the script with (from the top-level directory of a clone of CLIMA)</p><pre><code class="language-none">ln -s ../../.dev/hooks/pre-commit .git/hooks</code></pre><p>and then when <code>git commit</code> is run an error message will be given for julia files that are staged to be committed that are not formatted according to CLIMA&#39;s standard.  With this, when I try to commit changes to <code>src/Arrays/MPIStateArrays.jl</code> that are not formatted correctly I get the following error message.</p><pre><code class="language-none">❯ git commit                                                                                                           │
Activating environment at `~/research/code/CLIMA/.dev/Project.toml`                                                    │
┌ Error: File src/Arrays/MPIStateArrays.jl needs to be indented with:                                                  │
│     julia /home/lucas/research/code/CLIMA/.dev/climaformat.jl /home/lucas/research/code/CLIMA/src/Arrays/MPIStateArra│
ys.jl                                                                                                                  │
│ and added to the git index via                                                                                       │
│     git add /home/lucas/research/code/CLIMA/src/Arrays/MPIStateArrays.jl                                             │
└ @ Main ~/research/code/CLIMA/.git/hooks/pre-commit:30</code></pre><p>See <code>man 5 githooks</code> for more information about git hooks.</p><h3 id="Precompiling-the-JuliaFormatter-1"><a class="docs-heading-anchor" href="#Precompiling-the-JuliaFormatter-1">Precompiling the JuliaFormatter</a><a class="docs-heading-anchor-permalink" href="#Precompiling-the-JuliaFormatter-1" title="Permalink"></a></h3><p>To speed up the formatter and the githook, a custom system image can be built with the [<code>PackageCompiler</code>]. That said, the following [drawback] from the <code>PackageCompiler</code> repository should be noted:</p><blockquote><p>It should be clearly stated that there are some drawbacks to using a custom sysimage, thereby sidestepping the standard Julia package precompilation system. The biggest drawback is that packages that are compiled into a sysimage (including their dependencies!) are &quot;locked&quot; to the version they where at when the sysimage was created. This means that no matter what package version you have installed in your current project, the one in the sysimage will take precedence. This can lead to bugs where you start with a project that needs a specific version of a package, but you have another one compiled into the sysimage.</p></blockquote><p>The <code>PackageCompiler</code> compiler can be used with the <code>JuliaFormatter</code> using the following commands (from a top-level directory of a clone of CLIMA)</p><pre><code class="language-none">$ julia -q
julia&gt; using Pkg
julia&gt; Pkg.add(&quot;PackageCompiler&quot;)
julia&gt; using PackageCompiler
julia&gt; Pkg.activate(joinpath(@__DIR__,&quot;.dev&quot;))
julia&gt; using PackageCompiler
julia&gt; PackageCompiler.create_sysimage(:JuliaFormatter; precompile_execution_file=joinpath(@__DIR__, &quot;.dev/precompile.jl&quot;), replace_default=true)</code></pre><p>If you cannot (or do want to) modify the default system image, instead the following commands can be used</p><pre><code class="language-none">$ julia -q
julia&gt; using Pkg
julia&gt; Pkg.add(&quot;PackageCompiler&quot;)
julia&gt; using PackageCompiler
julia&gt; Pkg.activate(joinpath(@__DIR__,&quot;.dev&quot;))
julia&gt; PackageCompiler.create_sysimage(:JuliaFormatter; precompile_execution_file=joinpath(@__DIR__, &quot;.dev/precompile.jl&quot;), sysimage_path=joinpath(@__DIR__, &quot;.git/hooks/JuliaFormatterSysimage.so&quot;))</code></pre><p>In this case hook <code>pre-commit.sysimage</code> should be used. That is, one can use the following linking command (from the top-level directory of a clone of CLIMA)</p><pre><code class="language-none">ln -s ../../.dev/hooks/pre-commit.sysimage .git/hooks/pre-commit</code></pre><p>Note: By putting the system image in <code>.git/hooks</code> it will be protected from calls to <code>git clean -x</code></p><h2 id="Bors-and-CI-1"><a class="docs-heading-anchor" href="#Bors-and-CI-1">Bors and CI</a><a class="docs-heading-anchor-permalink" href="#Bors-and-CI-1" title="Permalink"></a></h2><p>All commits that end up in the CLIMA repository must pass Continuous Integration (CI). When a PR is updated, it will automatically be run on Microsoft Azure for Linux, Windows, and MacOS; however, because CLIMA is heterogeneous and must also run on GPU hardware, we also manually launch CI with Bors.</p><p>To test to see if all bors CI will pass, please type <code>bors try</code> in a separate comment in the PR. After this, if you are a collaborator you can merge the commit with <code>bors merge</code>. If you are a collaborator and want to test and merge in the same step, use <code>bors r+</code>.</p><h3 id="Tests-1"><a class="docs-heading-anchor" href="#Tests-1">Tests</a><a class="docs-heading-anchor-permalink" href="#Tests-1" title="Permalink"></a></h3><p>Most PRs should include tests and these will be reviewed as part of the code review process on github. Add your tests in the <code>test/</code> directory.</p><p>[<code>PackageCompiler</code>]: https://github.com/JuliaLang/PackageCompiler.jl [drawback]: https://julialang.github.io/PackageCompiler.jl/dev/sysimages/#Drawbacks-to-custom-sysimages-1</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../generated/literate_markdown/">« Notes on Literate</a><a class="docs-footer-nextpage" href="../IterativeSolvers/">Contribution Guide for Abstract Iterative Solvers »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 20 April 2020 15:36">Monday 20 April 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
